# 1 亨元模式的定义
亨元模式(flyweight)是一种性能优化的模式，fly是苍蝇的意思，意为蝇量级。亨元模式核心在于运用共享技术来有效地支持大量细粒度的对象。<br>
如果系统中出现了大量类似的对象而导致内存占用过高，亨元模式就比较有用了。

# 2 初识亨元模式
假设内衣厂，目前生产了50件男士T恤和50件女士T恤。现在要请模特穿上T恤并拍照。不使用亨元模式情况下，每件衣服都需要1个模特。
```javascript
// 模特类
var Model = function(sex, tShirt) {
    this.sex = sex;
    this.tShirt = tShirt;
}

Model.prototype.takePhoto = function() {
    console.log('sex:' + this.sex + ", tShrit: " + this.tShirt);
}

for ( var i = 1; i <= 50; i++ ){
    var maleModel = new Model( 'male', 'tShrit' + i );
    maleModel.takePhoto();
};
for ( var j = 1; j <= 50; j++ ){
    var femaleModel= new Model( 'female', 'tShrit' + j );
    femaleModel.takePhoto();
};
```
在这里创建了100个Model对象。但是实际情况我们只需要找一个男模特和一个女模特就够了。男模特穿50件T恤拍照，女模特穿50件T恤拍照。只需要2个对象便能够完成同样的功能。
```javascript
var Model = function(sex) {
    this.sex = sex;
    this.tShirt = null;
}

Model.prototype.takePhoto = function() {
    console.log('sex:' + this.sex + ", tShrit: " + this.tShirt);
}

var maleModel = new Model( 'male');
for ( var i = 1; i <= 50; i++ ){
    maleModel.tShirt = 'tShrit' + j;
    maleModel.takePhoto();
};
var femaleModel= new Model( 'female');
for ( var j = 1; j <= 50; j++ ){
    femaleModel.tShirt = 'tShrit' + j;
    femaleModel.takePhoto();
};
```
# 3 内部状态与外部状态
上面的例子中有了亨元模式的雏形，亨元模式要求将对象的属性划分为内部状态和外部状态。亨元模式的目标旨在减少共享对象的数量，关于如何划分内部状态和外部状态，下面有点经验指引：
- 内部状态存储于对象内部
- 内部状态可以被一些对象共享
- 内部状态独立于具体的场景，通常不会改变
- 外部状态取决于具体的场景，并根据场景而变化，外部状态不能被共享
这样我们可以把所有内部状态(性别)相同的对象(例如性别为女的一类50个人)指定为同一个共享独享(最终只需要以一个人)，外部对象可以从对象上脱离出来（T恤被脱离），并存储于外部。
- 剥离了外部状态(T恤)的对象成为共享对象（maleModel），外部状态在必要时被传入共享对象然后组装成为一个完整的对象。虽然耗时，但是减少了内存占用，亨元模式就是以时间换空间的优化模式。

# 4 利用亨元模式文件上传
1 小结中的亨元模式例子存在两个问题：
- 通过构造函数new出来的男女两个model对象，在其他系统中，也许并不不是一开始就需要所有的共享对象
- 给model手动设置的外部状态，在复杂的系统中，这不是一个好的方式，因为外部对象可能相当复杂，它们与共享对象的联系变的困难。<br>
解决第一个问题：可以使用对象工厂的方式来创建，当真正需要的时候才在工厂对象创建出来。<br>
解决第二个问题：用一个管理器来记录对象相关的外部状态，使这些外部状态通过某个钩子与共享对象联系起来。
